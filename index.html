<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>GPS Speedometer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* 使用 Google Fonts 的 Orbitron 字體來模仿電子錶風格 */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            touch-action: manipulation; /* 防止雙擊縮放 */
        }
        .speed-display {
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4 antialiased">

    <!-- 主容器 -->
    <div class="w-full max-w-md mx-auto text-center">

        <!-- 速度顯示圓盤 -->
        <div class="relative w-full aspect-square rounded-full bg-gray-800 border-8 border-gray-700 shadow-2xl flex flex-col items-center justify-center p-8 transition-colors duration-500" id="speed-container">
            <!-- 速度數字 -->
            <div id="speed" class="speed-display text-8xl md:text-9xl font-bold text-cyan-400 transition-colors duration-500">
                0
            </div>
            <!-- 速度單位 -->
            <div id="unit" class="text-3xl md:text-4xl font-semibold text-cyan-300 transition-colors duration-500 mt-2">
                km/h
            </div>
        </div>

        <!-- 狀態訊息 -->
        <div class="mt-8 text-center h-10">
            <p id="status" class="text-lg text-gray-400">正在等待 GPS 訊號...</p>
        </div>

        <!-- 單位切換按鈕 -->
        <div class="mt-6">
            <button id="unit-toggle" class="bg-gray-700 hover:bg-cyan-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105">
                切換至 MPH
            </button>
        </div>

        <!-- 頁腳 -->
        <footer class="mt-12 text-gray-500 text-sm">
            <p>請確保已開啟裝置的定位服務 (GPS)。</p>
            <p class="mt-1">數據僅供參考，請安全駕駛。</p>
        </footer>

    </div>

    <script>
        // 獲取頁面元素
        const speedElement = document.getElementById('speed');
        const unitElement = document.getElementById('unit');
        const statusElement = document.getElementById('status');
        const unitToggleButton = document.getElementById('unit-toggle');
        const speedContainer = document.getElementById('speed-container');

        // 初始化狀態
        let currentUnit = 'km/h'; // 'km/h' 或 'mph'
        let speedMps = 0; // 速度（米/秒）

        // 更新顯示的函數
        function updateDisplay() {
            let displaySpeed = 0;
            if (speedMps > 0.5) { // 只有在速度大於一個小閾值時才計算，避免靜止時的微小漂移
                if (currentUnit === 'km/h') {
                    displaySpeed = speedMps * 3.6;
                } else {
                    displaySpeed = speedMps * 2.23694;
                }
            }
            
            // 根據速度改變顏色
            let colorClass = 'text-cyan-400';
            if (displaySpeed > 60 && displaySpeed <= 100) {
                colorClass = 'text-yellow-400';
            } else if (displaySpeed > 100) {
                colorClass = 'text-red-500';
            }
            
            // 移除舊的顏色 class，添加新的
            speedElement.className = speedElement.className.replace(/text-(cyan|yellow|red)-[0-9]{3}/g, '');
            speedElement.classList.add(colorClass);

            unitElement.className = unitElement.className.replace(/text-(cyan|yellow|red)-[0-9]{3}/g, '');
            unitElement.classList.add(colorClass.replace('400','300').replace('500','400'));


            speedElement.textContent = displaySpeed.toFixed(0); // 顯示整數
            unitElement.textContent = currentUnit;
        }

        // 切換單位的函數
        unitToggleButton.addEventListener('click', () => {
            if (currentUnit === 'km/h') {
                currentUnit = 'mph';
                unitToggleButton.textContent = '切換至 KM/H';
            } else {
                currentUnit = 'km/h';
                unitToggleButton.textContent = '切換至 MPH';
            }
            updateDisplay();
        });

        // 檢查瀏覽器是否支援 Geolocation
        if ('geolocation' in navigator) {
            statusElement.textContent = '正在請求定位權限...';

            const options = {
                enableHighAccuracy: true, // 請求高精度位置
                timeout: 10000,           // 10秒超時
                maximumAge: 0             // 不使用快取位置
            };

            // 使用 watchPosition 持續獲取位置更新
            navigator.geolocation.watchPosition(
                (position) => {
                    // 成功獲取位置
                    statusElement.textContent = '✅ GPS 訊號已連接';
                    
                    // position.coords.speed 回傳的是米/秒 (m/s)
                    // 如果裝置靜止或無法確定速度，可能回傳 null
                    speedMps = position.coords.speed || 0;
                    
                    updateDisplay();
                },
                (error) => {
                    // 獲取位置失敗
                    speedMps = 0;
                    updateDisplay();
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            statusElement.textContent = '❌ 您已拒絕定位權限';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            statusElement.textContent = '⚠️ 無法獲取當前位置資訊';
                            break;
                        case error.TIMEOUT:
                            statusElement.textContent = '⏳ 請求位置資訊超時';
                            break;
                        default:
                            statusElement.textContent = '❓ 發生未知錯誤';
                            break;
                    }
                },
                options
            );

        } else {
            statusElement.textContent = '❌ 您的瀏覽器不支援定位功能';
            speedElement.textContent = 'ERR';
        }
    </script>
</body>
</html>
